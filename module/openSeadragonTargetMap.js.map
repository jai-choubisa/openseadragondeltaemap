{"version":3,"file":"openSeadragonTargetMap.js","sources":["../src/functions.js","../src/targetPatch.js","../src/targetChart.js","../src/targetMap.js","../src/index.js"],"sourcesContent":["/**\n * Test for values with which calculations can be done\n * @private\n * @param {arguments} anonymus - one or more values to test\n * @returns {boolean} is a useable number\n */\nconst isUsableNumber = function() {\n    let isUsable = Boolean(arguments.length)\n    Array.from(arguments).forEach(value => {\n        isUsable =\n            isUsable && typeof value === 'number' && Number.isFinite(value)\n    })\n    return isUsable\n}\n\n/**\n * Round at decimals\n * @private\n * @param {number} number - any number to round\n * @param {number} decimals - number of decimals to round at\n * @returns {number} the rounded number\n */\nconst roundAt = function(number, decimals) {\n    // https://www.jacklmoore.com/notes/rounding-in-javascript/\n    return Number(Math.round(number + 'e' + decimals) + 'e-' + decimals)\n}\n\nexport { isUsableNumber, roundAt }\n","const TargetPatch = function(patchData, parentNode, containerSize) {\n    this.name = 'TargetPatch'\n    this.element = document.createElement('targetPatch')\n\n    this.element.style.position = 'absolute'\n    this.element.style.left = `${(patchData.location.x * 100) /\n        containerSize.x}%`\n    this.element.style.top = `${(patchData.location.y * 100) /\n        containerSize.y}%`\n    this.element.style.width = `${(patchData.location.w * 100) /\n        containerSize.x}%`\n    this.element.style.height = `${(patchData.location.h * 100) /\n        containerSize.y}%`\n\n    this.element.style.boxShadow = 'inset 0 0 2px 2px orange'\n    parentNode.appendChild(this.element)\n}\n\nexport { TargetPatch }\n","import { TargetPatch } from '../src/targetPatch.js'\n\nconst TargetChart = function(chartData, parentNode, containerSize) {\n    this.name = 'TargetChart'\n    this.element = document.createElement('targetChart')\n    this.element.style.position = 'absolute'\n    this.element.style.left = `${(chartData.location.x * 100) /\n        containerSize.x}%`\n    this.element.style.top = `${(chartData.location.y * 100) /\n        containerSize.y}%`\n    this.element.style.width = `${(chartData.location.w * 100) /\n        containerSize.x}%`\n    this.element.style.height = `${(chartData.location.h * 100) /\n        containerSize.y}%`\n    this.element.style.boxShadow = 'inset 0 0 2px 2px darkviolet'\n    parentNode.appendChild(this.element)\n\n    this.patches = []\n    const contentSize = {\n        x: chartData.location.w,\n        y: chartData.location.h,\n    }\n    if (chartData.colorPatches) {\n        chartData.colorPatches.forEach(patchData => {\n            this.patches.push(\n                new TargetPatch(patchData, this.element, contentSize),\n            )\n        })\n    }\n    if (chartData.edgePatches) {\n        chartData.edgePatches.forEach(patchData => {\n            this.patches.push(\n                new TargetPatch(patchData, this.element, contentSize),\n            )\n        })\n    }\n}\n\nexport { TargetChart }\n","import { isUsableNumber, roundAt } from './functions'\nimport { TargetChart } from './targetChart'\n\nconst TargetMap = function(viewer) {\n    this.name = 'TargetMap'\n    this.element = document.createElement('targetmap')\n    this.element.style.position = 'absolute'\n    this.element.style.boxShadow = 'inset 0 0 2px 2px blue'\n\n    viewer.canvas.appendChild(this.element)\n\n    this.resize = () => {\n        this.tiledImage = viewer.world.getItemAt(0)\n        if (!this.tiledImage) return\n        const imageBounds = this.tiledImage.getBounds()\n\n        const leftTop = viewer.viewport.pixelFromPoint(imageBounds.getTopLeft())\n        const rightBottom = viewer.viewport.pixelFromPoint(\n            imageBounds.getBottomRight(),\n        )\n\n        if (!isUsableNumber(leftTop.x, leftTop.y, rightBottom.x, rightBottom.y))\n            return\n\n        const precision = 4\n        const box = {\n            left: roundAt(leftTop.x, precision),\n            top: roundAt(leftTop.y, precision),\n            width: roundAt(rightBottom.x - leftTop.x, precision),\n            height: roundAt(rightBottom.y - leftTop.y, precision),\n        }\n\n        this.element.style.left = `${box.left}px`\n        this.element.style.top = `${box.top}px`\n        this.element.style.width = `${box.width}px`\n        this.element.style.height = `${box.height}px`\n    }\n\n    viewer.addHandler('animation', () => {\n        this.resize()\n    })\n    viewer.addHandler('open', () => {\n        this.resize()\n    })\n    viewer.addHandler('rotate', () => {\n        this.resize()\n    })\n    viewer.addHandler('resize', () => {\n        this.resize()\n    })\n\n    this.resize()\n\n    this.charts = []\n    this.render = json => {\n        json.forEach(chartData => {\n            this.charts.push(\n                new TargetChart(\n                    chartData,\n                    this.element,\n                    this.tiledImage.getContentSize(),\n                ),\n            )\n        })\n    }\n}\n\nexport { TargetMap }\n","import { TargetMap } from './targetMap'\n\nvar index = (function() {\n    var $ = window.OpenSeadragon\n\n    if (!$) {\n        $ = require('openseadragon')\n        if (!$) {\n            throw new Error('OpenSeadragon is missing.')\n        }\n    }\n\n    $.Viewer.prototype.targetMap = function() {\n        if (!this._targetMap) {\n            this._targetMap = new TargetMap(this)\n        }\n        return this._targetMap\n    }\n})()\n\nexport default index\n"],"names":["roundAt","number","decimals","Number","Math","round","TargetPatch","patchData","parentNode","containerSize","this","name","element","document","createElement","style","position","left","location","x","top","y","width","w","height","h","boxShadow","appendChild","TargetChart","chartData","patches","contentSize","colorPatches","forEach","push","edgePatches","TargetMap","viewer","canvas","resize","tiledImage","world","getItemAt","imageBounds","getBounds","leftTop","viewport","pixelFromPoint","getTopLeft","rightBottom","getBottomRight","isUsable","Boolean","arguments","length","Array","from","value","isFinite","isUsableNumber","box","addHandler","charts","render","json","getContentSize","index","$","window","OpenSeadragon","require","Error","Viewer","prototype","targetMap","_targetMap"],"mappings":"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"}