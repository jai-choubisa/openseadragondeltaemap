const e=function(e,t){return Number(Math.round(e+"e"+t)+"e-"+t)},t=function(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e},n=function(e){return e&&(e.getRootNode()instanceof Document||e.getRootNode()instanceof ShadowRoot)},i=function(e,n,i){this.name="TargetPatch",this.element=document.createElement("targetPatch"),this.element.style.position="absolute",this.element.style.left=`${100*e.location.x/i.x}%`,this.element.style.top=`${100*e.location.y/i.y}%`,this.element.style.width=`${100*e.location.w/i.x}%`,this.element.style.height=`${100*e.location.h/i.y}%`,this.element.style.boxShadow="inset 0 0 2px 2px orange",n.appendChild(this.element);let o={};for(let[n,i]of Object.entries(e))t(i)&&(o[n]=i);e.reference&&(o.reference=e.reference),e.validity&&(o.validity=e.validity),this.element.dataset.picturaeTargetmapDisplay=JSON.stringify(o)},o=function(e,n,o){if(this.name="TargetChart",this.element=document.createElement("targetChart"),this.element.style.position="absolute",this.element.style.left=`${100*e.location.x/o.x}%`,this.element.style.top=`${100*e.location.y/o.y}%`,this.element.style.width=`${100*e.location.w/o.x}%`,this.element.style.height=`${100*e.location.h/o.y}%`,e.location.r&&180===e.location.r){this.element.style.transformOrigin="center center";const t=`rotate(${e.location.r}deg)`;this.element.style.transform=t}this.element.style.boxShadow="inset 0 0 2px 2px darkviolet",n.appendChild(this.element);let a={};for(let[n,i]of Object.entries(e))t(i)&&(a[n]=i);e.validity&&(a.validity=e.validity),this.element.dataset.picturaeTargetmapDisplay=JSON.stringify(a),this.patches=[];const s={x:e.location.w,y:e.location.h};e.colorPatches&&e.colorPatches.forEach(e=>{this.patches.push(new i(e,this.element,s))}),e.edgePatches&&e.edgePatches.forEach(e=>{this.patches.push(new i(e,this.element,s))})},a=function(t){this.name="TargetMap",this.element=document.createElement("targetmap"),this.element.style.position="absolute",this.element.style.boxShadow="inset 0 0 2px 2px blue",t.canvas.appendChild(this.element),this.resize=()=>{if(this.tiledImage=t.world.getItemAt(0),!this.tiledImage)return;const n=this.tiledImage.getBounds(),i=t.viewport.pixelFromPoint(n.getTopLeft()),o=t.viewport.pixelFromPoint(n.getBottomRight());if(!function(){let e=Boolean(arguments.length);return Array.from(arguments).forEach(t=>{e=e&&"number"==typeof t&&Number.isFinite(t)}),e}(i.x,i.y,o.x,o.y))return;const a=e(i.x,4),s=e(i.y,4),l=e(o.x-i.x,4),r=e(o.y-i.y,4);this.element.style.left=`${a}px`,this.element.style.top=`${s}px`,this.element.style.width=`${l}px`,this.element.style.height=`${r}px`},t.addHandler("animation",()=>{this.resize()}),t.addHandler("open",()=>{this.resize()}),t.addHandler("rotate",()=>{this.resize()}),t.addHandler("resize",()=>{this.resize()}),this.resize(),this.charts=[],this.render=e=>{e.targets.forEach(e=>{this.charts.push(new o(e,this.element,this.tiledImage.getContentSize()))})}};var s=function(){var e=window.OpenSeadragon;if(!e&&!(e=require("openseadragon")))throw new Error("OpenSeadragon is missing.");const i=document.createElement("table");i.className="picturae-targetmap-display",i.style.font="caption",i.style.position="fixed",i.style.background="#cccc",i.style.borderRadius="0 0 .5em .5em",i.style.color="#000",i.style.padding=".5em",i.style.bottom=".5em",i.style.right=".5em";e.Viewer.prototype.targetMap=function(){return this._targetMap||(this._targetMap=new a(this)),this._targetMap.element.addEventListener("mouseover",(function(e){const o=e.target.tagName&&e.target.tagName||"";e.relatedTarget&&e.relatedTarget.tagName;"TARGETCHART"===o||"TARGETPATCH"===o?function(e){const o=e.target.dataset.picturaeTargetmapDisplay;if(o){i.innerHTML="";const e=JSON.parse(o);let a="";e.patchType&&"color"===e.patchType&&t(e.R)&&t(e.G)&&t(e.B)&&(a=`<targetColor style="display: inline-block;\n                      background: rgb(${e.R}, ${e.G}, ${e.B});\n                  width: .75em; height: .75em"/>`),i.innerHTML+=`<caption\n                style="background: #cccc; border-radius: 0.5em 0.5em 0 0; padding: 0.5em; font-weight: bold;"\n            >\n                ${e.name} ${a}\n            </caption>`;for(let[n,o]of Object.entries(e)){let e="";t(o)&&"name"!==n&&(e=`<tr><th>${n}</th><td>${o}</td></tr>`),e&&(i.innerHTML+=e)}n(i)||document.body.appendChild(i)}}(e):(i.innerHTML="",n(i)&&document.body.removeChild(i)),e.stopPropagation()})),this._targetMap.element.addEventListener("mousemove",(function(e){e.clientX/document.body.clientWidth<.5?(i.style.left=`${e.clientX+16}px`,i.style.right="auto"):(i.style.left="auto",i.style.right=`${document.body.clientWidth-e.clientX+16}px`);const t=e.clientY/document.body.clientHeight;t<.333?(i.style.top=`${e.clientY+16}px`,i.style.bottom="auto"):t<.666?(i.style.top=`${(document.body.clientHeight-i.clientHeight)/2}px`,i.style.bottom="auto"):(i.style.top="auto",i.style.bottom=`${document.body.clientHeight-e.clientY+16}px`),e.stopPropagation()})),this._targetMap}}();export default s;
//# sourceMappingURL=openSeadragonTargetMap.js.map
