const e=function(e,t){return Number(Math.round(e+"e"+t)+"e-"+t)},t=function(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e},i=function(e){return e&&(e.getRootNode()instanceof Document||e.getRootNode()instanceof ShadowRoot)},n=function(e,i,n){this.name="TargetPatch",this.element=document.createElement("targetPatch"),this.element.style.position="absolute",this.element.style.left=`${100*e.location.x/n.x}%`,this.element.style.top=`${100*e.location.y/n.y}%`,this.element.style.width=`${100*e.location.w/n.x}%`,this.element.style.height=`${100*e.location.h/n.y}%`,this.element.style.boxShadow="inset 0 0 2px 2px orange",i.appendChild(this.element);let o={};for(let[i,n]of Object.entries(e))t(n)&&(o[i]=n);e.reference&&(o.reference=e.reference),e.validity&&(o.validity=e.validity),this.element.dataset.picturaeTargetmapDisplay=JSON.stringify(o)},o=function(e,i,o){if(this.name="TargetChart",this.element=document.createElement("targetChart"),this.element.style.position="absolute",this.element.style.left=`${100*e.location.x/o.x}%`,this.element.style.top=`${100*e.location.y/o.y}%`,this.element.style.width=`${100*e.location.w/o.x}%`,this.element.style.height=`${100*e.location.h/o.y}%`,e.location.r&&180===e.location.r){this.element.style.transformOrigin="center center";const t=`rotate(${e.location.r}deg)`;this.element.style.transform=t}this.element.style.boxShadow="inset 0 0 2px 2px darkviolet",i.appendChild(this.element);let a={};for(let[i,n]of Object.entries(e))t(n)&&(a[i]=n);e.validity&&(a.validity=e.validity),this.element.dataset.picturaeTargetmapDisplay=JSON.stringify(a),this.patches=[];const s={x:e.location.w,y:e.location.h};e.colorPatches&&e.colorPatches.forEach(e=>{e.patchType="color",this.patches.push(new n(e,this.element,s))}),e.edgePatches&&e.edgePatches.forEach(e=>{e.patchType="edge",this.patches.push(new n(e,this.element,s))})},a=function(e){this.name="TargetPatch";const n=document.body,o=document.createElement("table");this.element=o,o.className="picturae-targetmap-display",o.style.font="caption",o.style.position="fixed",o.style.background="#cccc",o.style.borderRadius="0 0 .5em .5em",o.style.color="#000",o.style.padding=".5em",o.style.bottom=".5em",o.style.right=".5em";e.addEventListener("mouseover",(function(e){const a=e.target.tagName&&e.target.tagName||"";"TARGETCHART"===a||"TARGETPATCH"===a?function(e){const a=e.target.dataset.picturaeTargetmapDisplay;if(a){o.innerHTML="";const e=JSON.parse(a);let s="";if(e.patchType&&"color"===e.patchType){s=`<targetColor style="display: inline-block;\n                    background: ${`rgb(${e.R}, ${e.G}, ${e.B})`}; box-shadow: 2px 2px 1px 0 #3339;\n                    width: .8em; height: .8em"/>`}o.innerHTML+=`<caption\n                style="background: #cccc; border-radius: 0.5em 0.5em 0 0; padding: 0.5em; font-weight: bold;"\n            >\n                ${e.name} ${s}\n            </caption>`;for(let[i,n]of Object.entries(e)){let e="";t(n)&&"name"!==i&&(e=`<tr><th>${i}</th><td>${n}</td></tr>`),e&&(o.innerHTML+=e)}i(o)||n.appendChild(o)}}(e):i(o)&&n.removeChild(o),e.stopPropagation()})),e.addEventListener("mousemove",(function(e){e.clientX/n.clientWidth<.5?(o.style.left=`${e.clientX+16}px`,o.style.right="auto"):(o.style.left="auto",o.style.right=`${n.clientWidth-e.clientX+16}px`);const t=e.clientY/n.clientHeight;t<.333?(o.style.top=`${e.clientY+16}px`,o.style.bottom="auto"):t<.666?(o.style.top=`${(n.clientHeight-o.clientHeight)/2}px`,o.style.bottom="auto"):(o.style.top="auto",o.style.bottom=`${n.clientHeight-e.clientY+16}px`),e.stopPropagation()}))},s=function(t){this.name="TargetMap",this.element=document.createElement("targetmap"),this.element.style.position="absolute",this.element.style.boxShadow="inset 0 0 2px 2px blue",t.canvas.appendChild(this.element),this.resize=()=>{if(this.tiledImage=t.world.getItemAt(0),!this.tiledImage)return;const i=this.tiledImage.getBounds(),n=t.viewport.pixelFromPoint(i.getTopLeft()),o=t.viewport.pixelFromPoint(i.getBottomRight());if(!function(){let e=Boolean(arguments.length);return Array.from(arguments).forEach(t=>{e=e&&"number"==typeof t&&Number.isFinite(t)}),e}(n.x,n.y,o.x,o.y))return;const a=e(n.x,4),s=e(n.y,4),l=e(o.x-n.x,4),r=e(o.y-n.y,4);this.element.style.left=`${a}px`,this.element.style.top=`${s}px`,this.element.style.width=`${l}px`,this.element.style.height=`${r}px`},t.addHandler("animation",()=>{this.resize()}),t.addHandler("open",()=>{this.resize()}),t.addHandler("rotate",()=>{this.resize()}),t.addHandler("resize",()=>{this.resize()}),this.resize(),this.charts=[],this.render=e=>{e.targets.forEach(e=>{this.charts.push(new o(e,this.element,this.tiledImage.getContentSize()))})},new a(this.element)};var l=function(){var e=window.OpenSeadragon;if(!e&&!(e=require("openseadragon")))throw new Error("OpenSeadragon is missing.");e.Viewer.prototype.targetMap=function(){return this._targetMap||(this._targetMap=new s(this)),this._targetMap}}();export default l;
//# sourceMappingURL=openSeadragonTargetMap.js.map
