{"version":3,"file":"openSeadragonTargetMap.js","sources":["../src/functions.js","../src/targetPatch.js","../src/targetChart.js","../src/targetMap.js","../src/index.js"],"sourcesContent":["/**\n * Test for values with which calculations can be done\n * @private\n * @param {arguments} anonymus - one or more values to test\n * @returns {boolean} is a useable number\n */\nconst isUsableNumber = function() {\n    let isUsable = Boolean(arguments.length)\n    Array.from(arguments).forEach(value => {\n        isUsable =\n            isUsable && typeof value === 'number' && Number.isFinite(value)\n    })\n    return isUsable\n}\n\n/**\n * Round at decimals\n * @private\n * @param {number} number - any number to round\n * @param {number} decimals - number of decimals to round at\n * @returns {number} the rounded number\n */\nconst roundAt = function(number, decimals) {\n    // https://www.jacklmoore.com/notes/rounding-in-javascript/\n    return Number(Math.round(number + 'e' + decimals) + 'e-' + decimals)\n}\n\n/**\n * Check for primitives\n * @private\n * @param {any} value - any value to check\n * @returns {boolean} is a primitive\n */\nconst isPrimitive = function(value) {\n    return (\n        typeof value === 'string' ||\n        typeof value === 'number' ||\n        typeof value === 'boolean'\n    )\n}\n\n/**\n * Check for the node being inside the DOM\n * @private\n * @param {Node} node\n * @returns {boolean} boolean - true when the node is onscreen -- not removed\n */\nconst isAttachedToDom = function(elm) {\n    return (\n        elm &&\n        (elm.getRootNode() instanceof Document ||\n            elm.getRootNode() instanceof ShadowRoot)\n    )\n}\n\nexport { isUsableNumber, roundAt, isPrimitive, isAttachedToDom }\n","import { isPrimitive } from './functions'\n\nconst TargetPatch = function(patchData, parentNode, containerSize) {\n    this.name = 'TargetPatch'\n    this.element = document.createElement('targetPatch')\n\n    this.element.style.position = 'absolute'\n    this.element.style.left = `${(patchData.location.x * 100) /\n        containerSize.x}%`\n    this.element.style.top = `${(patchData.location.y * 100) /\n        containerSize.y}%`\n    this.element.style.width = `${(patchData.location.w * 100) /\n        containerSize.x}%`\n    this.element.style.height = `${(patchData.location.h * 100) /\n        containerSize.y}%`\n\n    this.element.style.boxShadow = 'inset 0 0 2px 2px orange'\n    parentNode.appendChild(this.element)\n\n    let userData = {}\n    for (let [key, value] of Object.entries(patchData)) {\n        if (isPrimitive(value)) {\n            userData[key] = value\n        }\n    }\n    patchData.reference ? (userData.reference = patchData.reference) : null\n    patchData.validity ? (userData.validity = patchData.validity) : null\n    this.element.dataset.picturaeTargetmapDisplay = JSON.stringify(userData)\n}\n\nexport { TargetPatch }\n","import { isPrimitive } from './functions'\nimport { TargetPatch } from '../src/targetPatch.js'\n\nconst TargetChart = function(chartData, parentNode, containerSize) {\n    this.name = 'TargetChart'\n    this.element = document.createElement('targetChart')\n\n    this.element.style.position = 'absolute'\n    this.element.style.left = `${(chartData.location.x * 100) /\n        containerSize.x}%`\n    this.element.style.top = `${(chartData.location.y * 100) /\n        containerSize.y}%`\n    this.element.style.width = `${(chartData.location.w * 100) /\n        containerSize.x}%`\n    this.element.style.height = `${(chartData.location.h * 100) /\n        containerSize.y}%`\n    if (chartData.location.r) {\n        if (chartData.location.r === 180) {\n            this.element.style.transformOrigin = 'center center'\n            const rotate = `rotate(${chartData.location.r}deg)`\n            this.element.style.transform = rotate //+ ' ' + translate\n        }\n    }\n    this.element.style.boxShadow = 'inset 0 0 2px 2px darkviolet'\n    parentNode.appendChild(this.element)\n\n    let userData = {}\n    for (let [key, value] of Object.entries(chartData)) {\n        if (isPrimitive(value)) {\n            userData[key] = value\n        }\n    }\n    chartData.validity ? (userData.validity = chartData.validity) : null\n    this.element.dataset.picturaeTargetmapDisplay = JSON.stringify(userData)\n\n    this.patches = []\n    const contentSize = {\n        x: chartData.location.w,\n        y: chartData.location.h,\n    }\n    if (chartData.colorPatches) {\n        chartData.colorPatches.forEach(patchData => {\n            this.patches.push(\n                new TargetPatch(patchData, this.element, contentSize),\n            )\n        })\n    }\n    if (chartData.edgePatches) {\n        chartData.edgePatches.forEach(patchData => {\n            this.patches.push(\n                new TargetPatch(patchData, this.element, contentSize),\n            )\n        })\n    }\n}\n\nexport { TargetChart }\n","import { isUsableNumber, roundAt } from './functions'\nimport { TargetChart } from './targetChart'\n\nconst TargetMap = function(viewer) {\n    this.name = 'TargetMap'\n    this.element = document.createElement('targetmap')\n    this.element.style.position = 'absolute'\n    this.element.style.boxShadow = 'inset 0 0 2px 2px blue'\n\n    viewer.canvas.appendChild(this.element)\n\n    this.resize = () => {\n        this.tiledImage = viewer.world.getItemAt(0)\n        if (!this.tiledImage) return\n        const imageBounds = this.tiledImage.getBounds()\n\n        const leftTop = viewer.viewport.pixelFromPoint(imageBounds.getTopLeft())\n        const rightBottom = viewer.viewport.pixelFromPoint(\n            imageBounds.getBottomRight(),\n        )\n\n        if (!isUsableNumber(leftTop.x, leftTop.y, rightBottom.x, rightBottom.y))\n            return\n\n        const precision = 4\n        const box = {\n            left: roundAt(leftTop.x, precision),\n            top: roundAt(leftTop.y, precision),\n            width: roundAt(rightBottom.x - leftTop.x, precision),\n            height: roundAt(rightBottom.y - leftTop.y, precision),\n        }\n\n        this.element.style.left = `${box.left}px`\n        this.element.style.top = `${box.top}px`\n        this.element.style.width = `${box.width}px`\n        this.element.style.height = `${box.height}px`\n    }\n\n    viewer.addHandler('animation', () => {\n        this.resize()\n    })\n    viewer.addHandler('open', () => {\n        this.resize()\n    })\n    viewer.addHandler('rotate', () => {\n        this.resize()\n    })\n    viewer.addHandler('resize', () => {\n        this.resize()\n    })\n\n    this.resize()\n\n    this.charts = []\n    this.render = json => {\n        json.targets.forEach(chartData => {\n            this.charts.push(\n                new TargetChart(\n                    chartData,\n                    this.element,\n                    this.tiledImage.getContentSize(),\n                ),\n            )\n        })\n    }\n}\n\nexport { TargetMap }\n","import { isAttachedToDom, isPrimitive } from './functions'\nimport { TargetMap } from './targetMap'\n\nvar index = (function() {\n    var $ = window.OpenSeadragon\n\n    if (!$) {\n        $ = require('openseadragon')\n        if (!$) {\n            throw new Error('OpenSeadragon is missing.')\n        }\n    }\n\n    const table = document.createElement('table')\n    table.className = 'picturae-targetmap-display'\n    table.style.font = 'caption'\n    table.style.position = 'fixed'\n    table.style.background = '#cccc'\n    table.style.borderRadius = '0 0 .5em .5em'\n    table.style.color = '#000'\n    table.style.padding = '.5em'\n    table.style.bottom = '.5em'\n    table.style.right = '.5em'\n\n    const targetEnter = function(event) {\n        const targetValidation = event.target.dataset.picturaeTargetmapDisplay\n        if (targetValidation) {\n            table.innerHTML = ''\n            const validationData = JSON.parse(targetValidation)\n            let color = ''\n            if (\n                validationData.patchType &&\n                validationData.patchType === 'color'\n            ) {\n                if (\n                    isPrimitive(validationData.R) &&\n                    isPrimitive(validationData.G) &&\n                    isPrimitive(validationData.B)\n                ) {\n                    color = `<targetColor style=\"display: inline-block;\n                      background: rgb(${validationData.R}, ${validationData.G}, ${validationData.B});\n                  width: .75em; height: .75em\"/>`\n                }\n            }\n            table.innerHTML += `<caption\n                style=\"background: #cccc; border-radius: 0.5em 0.5em 0 0; padding: 0.5em; font-weight: bold;\"\n            >\n                ${validationData.name} ${color}\n            </caption>`\n            for (let [key, value] of Object.entries(validationData)) {\n                let row = ''\n                if (isPrimitive(value) && key !== 'name') {\n                    row = `<tr><th>${key}</th><td>${value}</td></tr>`\n                }\n                if (row) table.innerHTML += row\n            }\n            if (!isAttachedToDom(table)) document.body.appendChild(table)\n        }\n    }\n    const targetLeave = function(event) {\n        table.innerHTML = ''\n        if (isAttachedToDom(table)) document.body.removeChild(table)\n    }\n\n    $.Viewer.prototype.targetMap = function() {\n        if (!this._targetMap) {\n            this._targetMap = new TargetMap(this)\n        }\n\n        this._targetMap.element.addEventListener('mouseover', function(event) {\n            const enter = event.target.tagName ? event.target.tagName || '' : ''\n            const leave = event.relatedTarget\n                ? event.relatedTarget.tagName || ''\n                : ''\n            if (enter === 'TARGETCHART' || enter === 'TARGETPATCH') {\n                targetEnter(event)\n            } else {\n                targetLeave(event)\n            }\n            event.stopPropagation()\n        })\n\n        this._targetMap.element.addEventListener('mousemove', function(event) {\n            if (event.clientX / document.body.clientWidth < 0.5) {\n                table.style.left = `${event.clientX + 16}px`\n                table.style.right = 'auto'\n            } else {\n                table.style.left = 'auto'\n                table.style.right = `${document.body.clientWidth -\n                    event.clientX +\n                    16}px`\n            }\n            const yFraction = event.clientY / document.body.clientHeight\n            if (yFraction < 0.333) {\n                table.style.top = `${event.clientY + 16}px`\n                table.style.bottom = 'auto'\n            } else if (yFraction < 0.666) {\n                table.style.top = `${(document.body.clientHeight -\n                    table.clientHeight) /\n                    2}px`\n                table.style.bottom = 'auto'\n            } else {\n                table.style.top = 'auto'\n                table.style.bottom = `${document.body.clientHeight -\n                    event.clientY +\n                    16}px`\n            }\n            event.stopPropagation()\n        })\n\n        return this._targetMap\n    }\n})()\n\nexport default index\n"],"names":["roundAt","number","decimals","Number","Math","round","isPrimitive","value","isAttachedToDom","elm","getRootNode","Document","ShadowRoot","TargetPatch","patchData","parentNode","containerSize","this","name","element","document","createElement","style","position","left","location","x","top","y","width","w","height","h","boxShadow","appendChild","userData","key","Object","entries","reference","validity","dataset","picturaeTargetmapDisplay","JSON","stringify","TargetChart","chartData","r","transformOrigin","rotate","transform","patches","contentSize","colorPatches","forEach","push","edgePatches","TargetMap","viewer","canvas","resize","tiledImage","world","getItemAt","imageBounds","getBounds","leftTop","viewport","pixelFromPoint","getTopLeft","rightBottom","getBottomRight","isUsable","Boolean","arguments","length","Array","from","isFinite","isUsableNumber","box","addHandler","charts","render","json","targets","getContentSize","$","window","OpenSeadragon","require","Error","table","className","font","background","borderRadius","color","padding","bottom","right","Viewer","prototype","targetMap","_targetMap","addEventListener","event","enter","target","tagName","relatedTarget","targetValidation","innerHTML","validationData","parse","patchType","R","G","B","row","body","targetEnter","removeChild","stopPropagation","clientX","clientWidth","yFraction","clientY","clientHeight"],"mappings":"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"}