{"version":3,"file":"openSeadragonTargetMap.js","sources":["../src/functions.js","../src/targetChart.js","../src/targetMap.js","../src/index.js"],"sourcesContent":["/**\n * Test for values with which calculations can be done\n * @private\n * @param {arguments} anonymus - one or more values to test\n * @returns {boolean} is a useable number\n */\nconst isUsableNumber = function() {\n    let isUsable = Boolean(arguments.length)\n    Array.from(arguments).forEach(value => {\n        isUsable =\n            isUsable && typeof value === 'number' && Number.isFinite(value)\n    })\n    return isUsable\n}\n\n/**\n * Round at decimals\n * @private\n * @param {number} number - any number to round\n * @param {number} decimals - number of decimals to round at\n * @returns {number} the rounded number\n */\nconst roundAt = function(number, decimals) {\n    // https://www.jacklmoore.com/notes/rounding-in-javascript/\n    return Number(Math.round(number + 'e' + decimals) + 'e-' + decimals)\n}\n\nexport { isUsableNumber, roundAt }\n","const TargetChart = function(chartData, parentNode, tiledImage) {\n    this.name = 'TargetChart'\n    const imageDimensions = tiledImage.getContentSize()\n    this.element = document.createElement('targetChart')\n    this.element.style.position = 'absolute'\n    this.element.style.left = `${(chartData.location.x * 100) /\n        imageDimensions.x}%`\n    this.element.style.top = `${(chartData.location.y * 100) /\n        imageDimensions.y}%`\n    this.element.style.width = `${(chartData.location.w * 100) /\n        imageDimensions.x}%`\n    this.element.style.height = `${(chartData.location.h * 100) /\n        imageDimensions.y}%`\n    this.element.style.boxShadow = 'inset 0 0 2px 2px darkviolet'\n    parentNode.appendChild(this.element)\n}\n\nexport { TargetChart }\n","import { isUsableNumber, roundAt } from './functions'\nimport { TargetChart } from './targetChart'\n\nconst TargetMap = function(viewer) {\n    this.name = 'TargetMap'\n    this.element = document.createElement('targetmap')\n    this.element.style.position = 'absolute'\n    this.element.style.boxShadow = 'inset 0 0 2px 2px blue'\n\n    viewer.canvas.appendChild(this.element)\n\n    this.resize = () => {\n        this.tiledImage = viewer.world.getItemAt(0)\n        if (!this.tiledImage) return\n        const imageBounds = this.tiledImage.getBounds()\n\n        const leftTop = viewer.viewport.pixelFromPoint(imageBounds.getTopLeft())\n        const rightBottom = viewer.viewport.pixelFromPoint(\n            imageBounds.getBottomRight(),\n        )\n\n        if (!isUsableNumber(leftTop.x, leftTop.y, rightBottom.x, rightBottom.y))\n            return\n\n        const precision = 4\n        const box = {\n            left: roundAt(leftTop.x, precision),\n            top: roundAt(leftTop.y, precision),\n            width: roundAt(rightBottom.x - leftTop.x, precision),\n            height: roundAt(rightBottom.y - leftTop.y, precision),\n        }\n\n        this.element.style.left = `${box.left}px`\n        this.element.style.top = `${box.top}px`\n        this.element.style.width = `${box.width}px`\n        this.element.style.height = `${box.height}px`\n    }\n\n    viewer.addHandler('animation', () => {\n        this.resize()\n    })\n    viewer.addHandler('open', () => {\n        this.resize()\n    })\n    viewer.addHandler('rotate', () => {\n        this.resize()\n    })\n    viewer.addHandler('resize', () => {\n        this.resize()\n    })\n\n    this.resize()\n\n    this.charts = []\n    this.render = json => {\n        json.forEach(result => {\n            this.charts.push(\n                new TargetChart(result, this.element, this.tiledImage),\n            )\n        })\n    }\n}\n\nexport { TargetMap }\n","import { TargetMap } from './targetMap'\n\nvar index = (function() {\n    var $ = window.OpenSeadragon\n\n    if (!$) {\n        $ = require('openseadragon')\n        if (!$) {\n            throw new Error('OpenSeadragon is missing.')\n        }\n    }\n\n    $.Viewer.prototype.targetMap = function() {\n        if (!this._targetMap) {\n            this._targetMap = new TargetMap(this)\n        }\n        return this._targetMap\n    }\n})()\n\nexport default index\n"],"names":["roundAt","number","decimals","Number","Math","round","TargetChart","chartData","parentNode","tiledImage","this","name","imageDimensions","getContentSize","element","document","createElement","style","position","left","location","x","top","y","width","w","height","h","boxShadow","appendChild","TargetMap","viewer","canvas","resize","world","getItemAt","imageBounds","getBounds","leftTop","viewport","pixelFromPoint","getTopLeft","rightBottom","getBottomRight","isUsable","Boolean","arguments","length","Array","from","forEach","value","isFinite","isUsableNumber","box","addHandler","charts","render","json","result","push","$","window","OpenSeadragon","require","Error","Viewer","prototype","targetMap","_targetMap"],"mappings":"6MAMA,MAgBMA,EAAU,SAASC,EAAQC,GAE7B,OAAOC,OAAOC,KAAKC,MAAMJ,EAAS,IAAMC,GAAY,KAAOA,ICxBzDI,EAAc,SAASC,EAAWC,EAAYC,GAChDC,KAAKC,KAAO,cACZ,MAAMC,EAAkBH,EAAWI,iBACnCH,KAAKI,QAAUC,SAASC,cAAc,eACtCN,KAAKI,QAAQG,MAAMC,SAAW,WAC9BR,KAAKI,QAAQG,MAAME,KAAO,GAA2B,IAAvBZ,EAAUa,SAASC,EAC7CT,EAAgBS,KACpBX,KAAKI,QAAQG,MAAMK,IAAM,GAA2B,IAAvBf,EAAUa,SAASG,EAC5CX,EAAgBW,KACpBb,KAAKI,QAAQG,MAAMO,MAAQ,GAA2B,IAAvBjB,EAAUa,SAASK,EAC9Cb,EAAgBS,KACpBX,KAAKI,QAAQG,MAAMS,OAAS,GAA2B,IAAvBnB,EAAUa,SAASO,EAC/Cf,EAAgBW,KACpBb,KAAKI,QAAQG,MAAMW,UAAY,+BAC/BpB,EAAWqB,YAAYnB,KAAKI,UCX1BgB,EAAY,SAASC,GACvBrB,KAAKC,KAAO,YACZD,KAAKI,QAAUC,SAASC,cAAc,aACtCN,KAAKI,QAAQG,MAAMC,SAAW,WAC9BR,KAAKI,QAAQG,MAAMW,UAAY,yBAE/BG,EAAOC,OAAOH,YAAYnB,KAAKI,SAE/BJ,KAAKuB,OAAS,KAEV,GADAvB,KAAKD,WAAasB,EAAOG,MAAMC,UAAU,IACpCzB,KAAKD,WAAY,OACtB,MAAM2B,EAAc1B,KAAKD,WAAW4B,YAE9BC,EAAUP,EAAOQ,SAASC,eAAeJ,EAAYK,cACrDC,EAAcX,EAAOQ,SAASC,eAChCJ,EAAYO,kBAGhB,IFfe,WACnB,IAAIC,EAAWC,QAAQC,UAAUC,QAKjC,OAJAC,MAAMC,KAAKH,WAAWI,QAAQC,IAC1BP,EACIA,GAA6B,iBAAVO,GAAsBhD,OAAOiD,SAASD,KAE1DP,EESES,CAAef,EAAQjB,EAAGiB,EAAQf,EAAGmB,EAAYrB,EAAGqB,EAAYnB,GACjE,OAEJ,MACM+B,EACItD,EAAQsC,EAAQjB,EAFR,GACZiC,EAEGtD,EAAQsC,EAAQf,EAHP,GACZ+B,EAGKtD,EAAQ0C,EAAYrB,EAAIiB,EAAQjB,EAJzB,GACZiC,EAIMtD,EAAQ0C,EAAYnB,EAAIe,EAAQf,EAL1B,GAQlBb,KAAKI,QAAQG,MAAME,KAAO,GAAGmC,MAC7B5C,KAAKI,QAAQG,MAAMK,IAAM,GAAGgC,MAC5B5C,KAAKI,QAAQG,MAAMO,MAAQ,GAAG8B,MAC9B5C,KAAKI,QAAQG,MAAMS,OAAS,GAAG4B,OAGnCvB,EAAOwB,WAAW,YAAa,KAC3B7C,KAAKuB,WAETF,EAAOwB,WAAW,OAAQ,KACtB7C,KAAKuB,WAETF,EAAOwB,WAAW,SAAU,KACxB7C,KAAKuB,WAETF,EAAOwB,WAAW,SAAU,KACxB7C,KAAKuB,WAGTvB,KAAKuB,SAELvB,KAAK8C,OAAS,GACd9C,KAAK+C,OAASC,IACVA,EAAKR,QAAQS,IACTjD,KAAK8C,OAAOI,KACR,IAAItD,EAAYqD,EAAQjD,KAAKI,QAASJ,KAAKD,wBCvD/C,WACR,IAAIoD,EAAIC,OAAOC,cAEf,IAAKF,KACDA,EAAIG,QAAQ,kBAER,MAAM,IAAIC,MAAM,6BAIxBJ,EAAEK,OAAOC,UAAUC,UAAY,WAI3B,OAHK1D,KAAK2D,aACN3D,KAAK2D,WAAa,IAAIvC,EAAUpB,OAE7BA,KAAK2D,YAdR"}