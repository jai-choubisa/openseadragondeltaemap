!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).openSeadragonTargetMap=t()}(this,(function(){"use strict";const e=function(e,t){return Number(Math.round(e+"e"+t)+"e-"+t)},t=function(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e},n=function(e){return e&&(e.getRootNode()instanceof Document||e.getRootNode()instanceof ShadowRoot)},i=function(e,n,i){this.name="TargetPatch",this.element=document.createElement("targetPatch"),this.element.style.position="absolute",this.element.style.left=`${100*e.location.x/i.x}%`,this.element.style.top=`${100*e.location.y/i.y}%`,this.element.style.width=`${100*e.location.w/i.x}%`,this.element.style.height=`${100*e.location.h/i.y}%`,this.element.style.boxShadow="inset 0 0 2px 2px orange",n.appendChild(this.element);let o={};for(let[n,i]of Object.entries(e))t(i)&&(o[n]=i);e.reference&&(o.reference=e.reference),e.validity&&(o.validity=e.validity),this.element.dataset.picturaeTargetmapDisplay=JSON.stringify(o)},o=function(e,n,o){if(this.name="TargetChart",this.element=document.createElement("targetChart"),this.element.style.position="absolute",this.element.style.left=`${100*e.location.x/o.x}%`,this.element.style.top=`${100*e.location.y/o.y}%`,this.element.style.width=`${100*e.location.w/o.x}%`,this.element.style.height=`${100*e.location.h/o.y}%`,e.location.r&&180===e.location.r){this.element.style.transformOrigin="center center";const t=`rotate(${e.location.r}deg)`;this.element.style.transform=t}this.element.style.boxShadow="inset 0 0 2px 2px darkviolet",n.appendChild(this.element);let s={};for(let[n,i]of Object.entries(e))t(i)&&(s[n]=i);e.validity&&(s.validity=e.validity),this.element.dataset.picturaeTargetmapDisplay=JSON.stringify(s),this.patches=[];const a={x:e.location.w,y:e.location.h};e.colorPatches&&e.colorPatches.forEach(e=>{e.patchType="color",this.patches.push(new i(e,this.element,a))}),e.edgePatches&&e.edgePatches.forEach(e=>{e.patchType="edge",this.patches.push(new i(e,this.element,a))})},s=function(e){this.name="TargetPatch";const i=document.body,o=document.createElement("table");this.element=o,o.className="picturae-targetmap-display",o.style.font="caption",o.style.position="fixed",o.style.background="#cccc",o.style.borderRadius="0 0 .5em .5em",o.style.color="#000",o.style.padding=".5em",o.style.bottom=".5em",o.style.right=".5em";e.addEventListener("mouseover",(function(e){const s=e.target.tagName&&e.target.tagName||"";"TARGETCHART"===s||"TARGETPATCH"===s?function(e){const s=e.target.dataset.picturaeTargetmapDisplay;if(s){o.innerHTML="";const e=JSON.parse(s);let a="";if(e.patchType&&"color"===e.patchType){a=`<targetColor style="display: inline-block;\n                    background: ${`rgb(${e.R}, ${e.G}, ${e.B})`}; box-shadow: 2px 2px 1px 0 #3339;\n                    width: .8em; height: .8em"/>`}o.innerHTML+=`<caption\n                style="background: #cccc; border-radius: 0.5em 0.5em 0 0; padding: 0.5em; font-weight: bold;"\n            >\n                ${e.name} ${a}\n            </caption>`;for(let[n,i]of Object.entries(e)){let e="";t(i)&&"name"!==n&&(e=`<tr><th>${n}</th><td>${i}</td></tr>`),e&&(o.innerHTML+=e)}n(o)||i.appendChild(o)}}(e):n(o)&&i.removeChild(o),e.stopPropagation()})),e.addEventListener("mousemove",(function(e){e.clientX/i.clientWidth<.5?(o.style.left=`${e.clientX+16}px`,o.style.right="auto"):(o.style.left="auto",o.style.right=`${i.clientWidth-e.clientX+16}px`);const t=e.clientY/i.clientHeight;t<.333?(o.style.top=`${e.clientY+16}px`,o.style.bottom="auto"):t<.666?(o.style.top=`${(i.clientHeight-o.clientHeight)/2}px`,o.style.bottom="auto"):(o.style.top="auto",o.style.bottom=`${i.clientHeight-e.clientY+16}px`),e.stopPropagation()}))},a=function(t){this.name="TargetMap",this.element=document.createElement("targetmap"),this.element.style.position="absolute",this.element.style.boxShadow="inset 0 0 2px 2px blue",t.canvas.appendChild(this.element),this.resize=()=>{if(this.tiledImage=t.world.getItemAt(0),!this.tiledImage)return;const n=this.tiledImage.getBounds(),i=t.viewport.pixelFromPoint(n.getTopLeft()),o=t.viewport.pixelFromPoint(n.getBottomRight());if(!function(){let e=Boolean(arguments.length);return Array.from(arguments).forEach(t=>{e=e&&"number"==typeof t&&Number.isFinite(t)}),e}(i.x,i.y,o.x,o.y))return;const s=e(i.x,4),a=e(i.y,4),l=e(o.x-i.x,4),r=e(o.y-i.y,4);this.element.style.left=`${s}px`,this.element.style.top=`${a}px`,this.element.style.width=`${l}px`,this.element.style.height=`${r}px`},t.addHandler("animation",()=>{this.resize()}),t.addHandler("open",()=>{this.resize()}),t.addHandler("rotate",()=>{this.resize()}),t.addHandler("resize",()=>{this.resize()}),this.resize(),this.charts=[],this.render=e=>{e.targets.forEach(e=>{this.charts.push(new o(e,this.element,this.tiledImage.getContentSize()))})},new s(this.element)};return function(){var e=window.OpenSeadragon;if(!e&&!(e=require("openseadragon")))throw new Error("OpenSeadragon is missing.");e.Viewer.prototype.targetMap=function(){return this._targetMap||(this._targetMap=new a(this)),this._targetMap}}()}));
//# sourceMappingURL=openSeadragonTargetMap.js.map
