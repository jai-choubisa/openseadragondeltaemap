!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).openSeadragonTargetMap=e()}(this,(function(){"use strict";const t=function(t,e){return Number(Math.round(t+"e"+e)+"e-"+e)},e=function(t){return"string"==typeof t||"number"==typeof t||"boolean"==typeof t},n=function(t){return t&&(t.getRootNode()instanceof Document||t.getRootNode()instanceof ShadowRoot)},i=function(t,n,i){this.name="TargetPatch",this.element=document.createElement("targetPatch"),this.element.style.left=`${100*t.location.x/i.x}%`,this.element.style.top=`${100*t.location.y/i.y}%`,this.element.style.width=`${100*t.location.w/i.x}%`,this.element.style.height=`${100*t.location.h/i.y}%`,n.appendChild(this.element);let o={};for(let[n,i]of Object.entries(t))e(i)&&(o[n]=i);t.reference&&(o.reference=t.reference),t.validity&&(o.validity=t.validity),this.element.dataset.picturaeTargetmapDisplay=JSON.stringify(o)},o=function(t,n,o){if(this.name="TargetChart",this.element=document.createElement("targetChart"),this.element.style.left=`${100*t.location.x/o.x}%`,this.element.style.top=`${100*t.location.y/o.y}%`,this.element.style.width=`${100*t.location.w/o.x}%`,this.element.style.height=`${100*t.location.h/o.y}%`,t.location.r&&180===t.location.r){this.element.style.transformOrigin="center center";const e=`rotate(${t.location.r}deg)`;this.element.style.transform=e}n.appendChild(this.element);let a={};for(let[n,i]of Object.entries(t))e(i)&&(a[n]=i);t.validity&&(a.validity=t.validity),this.element.dataset.picturaeTargetmapDisplay=JSON.stringify(a),this.patches=[];const s={x:t.location.w,y:t.location.h};t.colorPatches&&t.colorPatches.forEach(t=>{t.patchType="color",this.patches.push(new i(t,this.element,s))}),t.edgePatches&&t.edgePatches.forEach(t=>{t.patchType="edge",this.patches.push(new i(t,this.element,s))})},a=function(t){this.name="TargetPatch";const i=document.body,o=document.createElement("table");this.element=o,o.className="picturae-targetmap-display";t.addEventListener("mouseover",(function(t){const a=t.target.tagName&&t.target.tagName||"";"TARGETCHART"===a||"TARGETPATCH"===a?function(t){const a=t.target.dataset.picturaeTargetmapDisplay;if(a){o.innerHTML="";const t=JSON.parse(a);let s="";if(t.patchType&&"color"===t.patchType){s=`<targetColor style="background: ${`rgb(${t.R}, ${t.G}, ${t.B})`};"/>`}o.innerHTML+=`<caption>\n                ${t.name} ${s}\n            </caption>`;for(let[n,i]of Object.entries(t)){let t="";e(i)&&"name"!==n&&(t=`<tr><th>${n}</th><td>${i}</td></tr>`),t&&(o.innerHTML+=t)}n(o)||i.appendChild(o)}}(t):n(o)&&i.removeChild(o),t.stopPropagation()})),t.addEventListener("mousemove",(function(t){t.clientX/i.clientWidth<.5?(o.style.left=`${t.clientX+16}px`,o.style.right="auto"):(o.style.left="auto",o.style.right=`${i.clientWidth-t.clientX+16}px`);const e=t.clientY/i.clientHeight;e<.333?(o.style.top=`${t.clientY+16}px`,o.style.bottom="auto"):e<.666?(o.style.top=`${(i.clientHeight-o.clientHeight)/2}px`,o.style.bottom="auto"):(o.style.top="auto",o.style.bottom=`${i.clientHeight-t.clientY+16}px`),t.stopPropagation()}))},s=function(e){this.name="TargetMap",this.element=document.createElement("targetmap"),e.canvas.appendChild(this.element),this.resize=()=>{if(this.tiledImage=e.world.getItemAt(0),!this.tiledImage)return;const n=this.tiledImage.getBounds(),i=e.viewport.pixelFromPoint(n.getTopLeft()),o=e.viewport.pixelFromPoint(n.getBottomRight());if(!function(){let t=Boolean(arguments.length);return Array.from(arguments).forEach(e=>{t=t&&"number"==typeof e&&Number.isFinite(e)}),t}(i.x,i.y,o.x,o.y))return;const a=t(i.x,4),s=t(i.y,4),r=t(o.x-i.x,4),l=t(o.y-i.y,4);this.element.style.left=`${a}px`,this.element.style.top=`${s}px`,this.element.style.width=`${r}px`,this.element.style.height=`${l}px`},e.addHandler("animation",()=>{this.resize()}),e.addHandler("open",()=>{this.resize()}),e.addHandler("rotate",()=>{this.resize()}),e.addHandler("resize",()=>{this.resize()}),this.resize(),this.charts=[],this.render=t=>{t.targets.forEach(t=>{this.charts.push(new o(t,this.element,this.tiledImage.getContentSize()))})},new a(this.element)};return function(){var t=window.OpenSeadragon;if(!t&&!(t=require("openseadragon")))throw new Error("OpenSeadragon is missing.");t.Viewer.prototype.targetMap=function(){return this._targetMap||(this._targetMap=new s(this)),this._targetMap}}()}));
//# sourceMappingURL=openSeadragonTargetMap.js.map
