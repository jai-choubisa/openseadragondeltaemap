!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).openSeadragonTargetMap=t()}(this,(function(){"use strict";const e=function(e,t){return Number(Math.round(e+"e"+t)+"e-"+t)},t=function(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e},i=function(e){return e&&(e.getRootNode()instanceof Document||e.getRootNode()instanceof ShadowRoot)},n=function(e,t={}){t.preserve||(t.preserve=[]),t.replace||(t.replace={}),t.seperator||(t.seperator=" ");const i=e=>e===e.toUpperCase()&&e!==e.toLowerCase();return(e=>{if(t.preserve.length&&t.preserve.forEach(e=>{t.replace[e]=e}),t.replace&&"{}"!==JSON.stringify(t.replace))for(let[i,n]of Object.entries(t.replace))e=e.replace(new RegExp(i,"g"),t.seperator+n+t.seperator),t.preserve.includes(n)||t.preserve.push(n);let n=(e=(e=>{const i=new RegExp("^"+t.seperator),n=new RegExp(t.seperator+"$"),a=new RegExp(t.seperator+t.seperator,"g");return e.replace(i,"").replace(n,"").replace(a,t.seperator)})(e)).trim().split(t.seperator);return n=n.map(e=>t.preserve.includes(e)?e:(e=>{let n=e[0];for(let r=1;r<e.length;r++)(a=e[r-1])===a.toLowerCase()&&a!==a.toUpperCase()&&i(e[r])&&(n+=t.seperator),n+=e[r];var a;return n})(e)),n.flat()})(e=e.trim()).map(e=>t.preserve.includes(e)?e:e.substr(0,1).toUpperCase()+e.substr(1)).join(t.seperator)},a=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r=function(e,t,i){this.name="TargetPatch",this.element=document.createElement("targetPatch"),this.element.style.left=`${100*e.location.x/i.x}%`,this.element.style.top=`${100*e.location.y/i.y}%`,this.element.style.width=`${100*e.location.w/i.x}%`,this.element.style.height=`${100*e.location.h/i.y}%`,t.appendChild(this.element);let n={};for(let[t,i]of Object.entries(e))"location"!==t&&(n[t]=i);if(this.element.dataset.picturaeTargetmapDisplay=JSON.stringify(n),n.validity&&a(n.validity,"valid")){const e=n.validity.valid;this.element.classList.add(e?"valid":"invalid")}},o=function(e,t,i){if(this.name="TargetChart",this.element=document.createElement("targetChart"),this.element.style.left=`${100*e.location.x/i.x}%`,this.element.style.top=`${100*e.location.y/i.y}%`,this.element.style.width=`${100*e.location.w/i.x}%`,this.element.style.height=`${100*e.location.h/i.y}%`,e.location.r&&180===e.location.r){this.element.style.transformOrigin="center center";const t=`rotate(${e.location.r}deg)`;this.element.style.transform=t}t.appendChild(this.element);let n={};for(let[t,i]of Object.entries(e))"location"!==t&&"colorPatches"!==t&&"edgePatches"!==t&&(n[t]=i);if(this.element.dataset.picturaeTargetmapDisplay=JSON.stringify(n),n.validity&&a(n.validity,"valid")){const e=n.validity.valid;this.element.classList.add(e?"valid":"invalid")}this.patches=[];const o={x:e.location.w,y:e.location.h};e.colorPatches&&e.colorPatches.forEach(e=>{e.patchType="color",this.patches.push(new r(e,this.element,o))})},s=function(e){this.name="DisplayTable";const r=document.body,o=document.createElement("table");this.element=o,o.className="picturae-targetmap-display";const s=e=>{if(null===e)return"--";if("boolean"==typeof e){return`<targetBoolean class="${e?"valid":"invalid"}"></targetBoolean>`}if(t(e))return e;if(e instanceof Array&&e.length){if(t(e[0]))return e.join(", ");if("object"==typeof e[0]){let t="";for(let i=0;i<e.length;i++)t+=s(e[i]);return t}}if("object"==typeof e&&!(e instanceof Array)){let t="";for(let[i,a]of Object.entries(e)){let e="";e="boolean"==typeof a?`${s(a)} ${n(i)}<br/>`:`${n(i)}: ${s(a)}<br/>`,e&&(t+=e)}return t+""}},l=(e,t)=>{let i=`<tbody name="${e}">`;for(let[e,a]of Object.entries(t)){let t="";t=`<tr><th>${n(e,{replace:{deltaE:"&Delta;E",DeltaE:"&Delta;E",deltaL:"&Delta;L",DeltaL:"&Delta;L"}})}</th><td>${s(a)}</td></tr>`,t&&(i+=t)}return i+="</tbody>",i};e.addEventListener("mouseover",(function(e){const t=e.target;"TARGETMAP"===t.tagName||"TARGETCHART"===t.tagName||"TARGETPATCH"===t.tagName?function(e){const t=e.target.dataset.picturaeTargetmapDisplay;if(t){o.innerHTML="";const e=JSON.parse(t);let n="";if(e.patchType&&"color"===e.patchType){n=`<targetColor style="background: ${`rgb(${e.observed.RGB.join()})`};"></targetColor>`}if(o.innerHTML+=`<caption>\n                ${e.name} ${n}\n            </caption>`,e.assessed&&(o.innerHTML+=l("assessed",e.assessed)),e.observed&&(o.innerHTML+=l("observed",e.observed)),e.reference&&(o.innerHTML+=l("reference",e.reference)),e.validity){if(a(e.validity,"valid")){const t=e.validity.valid;o.classList.remove("valid","invalid"),o.classList.add(t?"valid":"invalid")}o.innerHTML+=l("validity",e.validity)}i(o)||r.appendChild(o)}}(e):o.contains(t)||i(o)&&r.removeChild(o),e.stopPropagation()})),e.addEventListener("mousemove",(function(e){e.clientX/r.clientWidth<.5?(o.style.left=`${e.clientX+16}px`,o.style.right="auto"):(o.style.left="auto",o.style.right=`${r.clientWidth-e.clientX+16}px`);const t=(r.clientHeight-o.clientHeight)/2;e.clientY<t-16?(o.style.top=`${e.clientY+16}px`,o.style.bottom="auto"):e.clientY<t+16+o.clientHeight?(o.style.top=`${t}px`,o.style.bottom="auto"):(o.style.top="auto",o.style.bottom=`${r.clientHeight-e.clientY+16}px`),e.stopPropagation()}))},l=function(t){this.name="TargetMap",this.element=document.createElement("targetmap"),t.canvas.appendChild(this.element),this.resize=()=>{if(this.tiledImage=t.world.getItemAt(0),!this.tiledImage)return;const i=this.tiledImage.getBounds(),n=t.viewport.pixelFromPoint(i.getTopLeft()),a=t.viewport.pixelFromPoint(i.getBottomRight());if(!function(){let e=Boolean(arguments.length);return Array.from(arguments).forEach(t=>{e=e&&"number"==typeof t&&Number.isFinite(t)}),e}(n.x,n.y,a.x,a.y))return;const r=e(n.x,4),o=e(n.y,4),s=e(a.x-n.x,4),l=e(a.y-n.y,4);this.element.style.left=`${r}px`,this.element.style.top=`${o}px`,this.element.style.width=`${s}px`,this.element.style.height=`${l}px`},t.addHandler("animation",()=>{this.resize()}),t.addHandler("open",()=>{this.resize()}),t.addHandler("rotate",()=>{this.resize()}),t.addHandler("resize",()=>{this.resize()}),this.resize(),this.charts=[],this.render=e=>{this.element.innerHTML="",e.name||(e.name="Target Scan");let t={};for(let[i,n]of Object.entries(e))"targets"!==i&&(t[i]=n);if(this.element.dataset.picturaeTargetmapDisplay=JSON.stringify(t),t.validity&&a(t.validity,"valid")){const e=t.validity.valid;this.element.classList.add(e?"valid":"invalid")}e.targets.forEach(e=>{this.charts.push(new o(e,this.element,this.tiledImage.getContentSize()))})},new s(document.body)};return function(){var e=window.OpenSeadragon;if(!e&&!(e=require("openseadragon")))throw new Error("OpenSeadragon is missing.");e.Viewer.prototype.targetMap=function(){return this._targetMap||(this._targetMap=new l(this)),this._targetMap}}()}));
//# sourceMappingURL=openSeadragonTargetMap.js.map
