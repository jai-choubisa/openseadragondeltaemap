!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).openSeadragonTargetMap=t()}(this,(function(){"use strict";const e=function(e,t){return Number(Math.round(e+"e"+t)+"e-"+t)},t=function(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e},n=function(e){return e&&(e.getRootNode()instanceof Document||e.getRootNode()instanceof ShadowRoot)},r=function(e,t={}){t.preserve||(t.preserve=[]),t.replace||(t.replace={}),t.seperator||(t.seperator=" ");const n=e=>e===e.toUpperCase()&&e!==e.toLowerCase();return(e=>{if(t.preserve.length&&t.preserve.forEach(e=>{t.replace[e]=e}),t.replace&&"{}"!==JSON.stringify(t.replace))for(let[n,r]of Object.entries(t.replace))e=e.replace(new RegExp(n,"g"),t.seperator+r+t.seperator),t.preserve.includes(r)||t.preserve.push(r);let r=(e=(e=>{const n=new RegExp("^"+t.seperator),r=new RegExp(t.seperator+"$"),i=new RegExp(t.seperator+t.seperator,"g");return e.replace(n,"").replace(r,"").replace(i,t.seperator)})(e)).trim().split(t.seperator);return r=r.map(e=>t.preserve.includes(e)?e:(e=>{let r=e[0];for(let a=1;a<e.length;a++)(i=e[a-1])===i.toLowerCase()&&i!==i.toUpperCase()&&n(e[a])&&(r+=t.seperator),r+=e[a];var i;return r})(e)),r.flat()})(e=e.trim()).map(e=>t.preserve.includes(e)?e:e.substr(0,1).toUpperCase()+e.substr(1)).join(t.seperator)},i=function(e,n,r){this.name="TargetPatch",this.element=document.createElement("targetPatch"),this.element.style.left=`${100*e.location.x/r.x}%`,this.element.style.top=`${100*e.location.y/r.y}%`,this.element.style.width=`${100*e.location.w/r.x}%`,this.element.style.height=`${100*e.location.h/r.y}%`,n.appendChild(this.element);let i={};for(let[n,r]of Object.entries(e))t(r)&&(i[n]=r);e.reference&&(i.reference=e.reference),e.validity&&(i.validity=e.validity),this.element.dataset.picturaeTargetmapDisplay=JSON.stringify(i)},a=function(e,n,r){if(this.name="TargetChart",this.element=document.createElement("targetChart"),this.element.style.left=`${100*e.location.x/r.x}%`,this.element.style.top=`${100*e.location.y/r.y}%`,this.element.style.width=`${100*e.location.w/r.x}%`,this.element.style.height=`${100*e.location.h/r.y}%`,e.location.r&&180===e.location.r){this.element.style.transformOrigin="center center";const t=`rotate(${e.location.r}deg)`;this.element.style.transform=t}n.appendChild(this.element);let a={};for(let[n,r]of Object.entries(e))t(r)&&(a[n]=r);e.validity&&(a.validity=e.validity),this.element.dataset.picturaeTargetmapDisplay=JSON.stringify(a),this.patches=[];const o={x:e.location.w,y:e.location.h};e.colorPatches&&e.colorPatches.forEach(e=>{e.patchType="color",this.patches.push(new i(e,this.element,o))}),e.edgePatches&&e.edgePatches.forEach(e=>{e.patchType="edge",this.patches.push(new i(e,this.element,o))})},o=function(e){this.name="TargetPatch";const i=document.body,a=document.createElement("table");this.element=a,a.className="picturae-targetmap-display";e.addEventListener("mouseover",(function(e){const o=e.target.tagName&&e.target.tagName||"";"TARGETCHART"===o||"TARGETPATCH"===o?function(e){const o=e.target.dataset.picturaeTargetmapDisplay;if(o){a.innerHTML="";const e=JSON.parse(o);let s="";if(e.patchType&&"color"===e.patchType){s=`<targetColor style="background: ${`rgb(${e.R}, ${e.G}, ${e.B})`};"/>`}a.innerHTML+=`<caption>\n                ${e.name} ${s}\n            </caption>`;for(let[n,i]of Object.entries(e)){let e="";t(i)&&"name"!==n&&(e=`<tr><th>${r(n,{replace:{deltaE:"&Delta;E",DeltaE:"&Delta;E",deltaL:"&Delta;L",DeltaL:"&Delta;L"}})}</th><td>${i}</td></tr>`),e&&(a.innerHTML+=e)}n(a)||i.appendChild(a)}}(e):n(a)&&i.removeChild(a),e.stopPropagation()})),e.addEventListener("mousemove",(function(e){e.clientX/i.clientWidth<.5?(a.style.left=`${e.clientX+16}px`,a.style.right="auto"):(a.style.left="auto",a.style.right=`${i.clientWidth-e.clientX+16}px`);const t=e.clientY/i.clientHeight;t<.333?(a.style.top=`${e.clientY+16}px`,a.style.bottom="auto"):t<.666?(a.style.top=`${(i.clientHeight-a.clientHeight)/2}px`,a.style.bottom="auto"):(a.style.top="auto",a.style.bottom=`${i.clientHeight-e.clientY+16}px`),e.stopPropagation()}))},s=function(t){this.name="TargetMap",this.element=document.createElement("targetmap"),t.canvas.appendChild(this.element),this.resize=()=>{if(this.tiledImage=t.world.getItemAt(0),!this.tiledImage)return;const n=this.tiledImage.getBounds(),r=t.viewport.pixelFromPoint(n.getTopLeft()),i=t.viewport.pixelFromPoint(n.getBottomRight());if(!function(){let e=Boolean(arguments.length);return Array.from(arguments).forEach(t=>{e=e&&"number"==typeof t&&Number.isFinite(t)}),e}(r.x,r.y,i.x,i.y))return;const a=e(r.x,4),o=e(r.y,4),s=e(i.x-r.x,4),l=e(i.y-r.y,4);this.element.style.left=`${a}px`,this.element.style.top=`${o}px`,this.element.style.width=`${s}px`,this.element.style.height=`${l}px`},t.addHandler("animation",()=>{this.resize()}),t.addHandler("open",()=>{this.resize()}),t.addHandler("rotate",()=>{this.resize()}),t.addHandler("resize",()=>{this.resize()}),this.resize(),this.charts=[],this.render=e=>{e.targets.forEach(e=>{this.charts.push(new a(e,this.element,this.tiledImage.getContentSize()))})},new o(this.element)};return function(){var e=window.OpenSeadragon;if(!e&&!(e=require("openseadragon")))throw new Error("OpenSeadragon is missing.");e.Viewer.prototype.targetMap=function(){return this._targetMap||(this._targetMap=new s(this)),this._targetMap}}()}));
//# sourceMappingURL=openSeadragonTargetMap.js.map
